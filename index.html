<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#22d3ee" />
  <title>Bubble</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="float-bubbles" id="floatBubbles" aria-hidden="true"></div>
  <div class="hero">
    <a href="#main" class="bubble-wrap" id="bubbleWrap" aria-label="Go to main page">
      <h1 class="logo" aria-label="Bubble"><span id="logoText"></span><span class="logo-cursor" id="logoCursor"></span>
      </h1>
    </a>
  </div>
  <main id="main" class="main">
  </main>

  <div id="loginPopup" class="popup-overlay hidden">
    <div class="popup-box">
      <h2>Log in or create an account</h2>
      <form id="emailForm" class="login-form" novalidate>
        <div class="input-group">
          <input type="email" id="emailInput" placeholder="University Email (.edu)" class="bubble-input" required>
          <p id="emailError" class="error-msg hidden">Please enter a valid .edu email address.</p>
        </div>
        <button type="submit" class="btn-add">Continue</button>
      </form>
    </div>
  </div>

  <script>
    (function () {
      var logoEl = document.getElementById('logoText');
      var logoTitle = document.querySelector('.logo');
      var bubbleWrap = document.getElementById('bubbleWrap');
      var floatContainer = document.getElementById('floatBubbles');
      var word = 'Bubble';
      var i = 0;
      function type() {
        if (logoEl && logoTitle && i < word.length) {
          logoEl.textContent += word[i];
          i++;
          setTimeout(type, 320);
        } else if (logoTitle) {
          logoTitle.classList.add('logo-done');
          if (bubbleWrap) bubbleWrap.classList.add('reveal');
          document.body.classList.add('bubble-done');
          if (floatContainer) {
            for (var b = 0; b < 18; b++) {
              var el = document.createElement('div');
              el.className = 'float-bubble';
              el.style.left = Math.random() * 100 + '%';
              el.style.width = el.style.height = (12 + Math.random() * 24) + 'px';
              el.style.animationDelay = (Math.random() * 5) + 's';
              el.style.animationDuration = (6 + Math.random() * 4) + 's';
              floatContainer.appendChild(el);
            }
          }
        }
      }
      setTimeout(type, 800);

      // Handle main bubble click
      bubbleWrap.addEventListener('click', function (e) {
        e.preventDefault();

        // Prevent further clicks
        bubbleWrap.style.pointerEvents = 'none';

        // Add popping animation to main bubble
        bubbleWrap.classList.add('popping-main');

        // Create spray effect
        var hero = document.querySelector('.hero');
        if (hero) {
          for (var s = 0; s < 25; s++) {
            var drop = document.createElement('div');
            drop.className = 'spray-drop';
            var angle = Math.random() * Math.PI * 2;
            var velocity = 150 + Math.random() * 250;
            drop.style.setProperty('--tx', (Math.cos(angle) * velocity) + 'px');
            drop.style.setProperty('--ty', (Math.sin(angle) * velocity) + 'px');
            hero.appendChild(drop);
          }
        }

        // Wait for bubble to completely pop (pop animation is 450ms)
        setTimeout(function () {
          var hero = document.querySelector('.hero');
          if (hero) hero.style.display = 'none'; // Hide the popped bubble completely 

          if (floatContainer) floatContainer.classList.add('fade-out');

          // Only after the bubble is gone and background is fading do we show the popup
          setTimeout(function () {
            if (floatContainer) floatContainer.style.display = 'none';
            var loginPopup = document.getElementById('loginPopup');
            if (loginPopup) loginPopup.classList.remove('hidden');
          }, 400); // Wait for fade out
        }, 650); // Significant delay to clearly show it popped empty space
      });

      // Handle form validation
      var emailForm = document.getElementById('emailForm');
      var emailInput = document.getElementById('emailInput');
      var emailError = document.getElementById('emailError');

      if (emailForm) {
        emailForm.addEventListener('submit', function (e) {
          e.preventDefault();
          var email = emailInput.value.trim().toLowerCase();
          if (!email.endsWith('.edu')) {
            emailError.classList.remove('hidden');
            emailInput.classList.add('input-error');
          } else {
            emailError.classList.add('hidden');
            emailInput.classList.remove('input-error');
            // In a real app, you would proceed to the next step here
            emailInput.value = '';
            emailInput.placeholder = 'Success! Proceeding...';
          }
        });
      }

    })();
  </script>
  <script src="app.js"></script>
</body>

</html>