<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#22d3ee" />
  <title>Bubble</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="float-bubbles" id="floatBubbles" aria-hidden="true"></div>
  <div class="hero">
    <a href="#main" class="bubble-wrap" id="bubbleWrap" aria-label="Go to main page">
      <h1 class="logo" aria-label="Bubble"><span id="logoText"></span><span class="logo-cursor" id="logoCursor"></span>
      </h1>
    </a>
  </div>
  <main id="main" class="main">
  </main>

  <div id="loginPopup" class="popup-overlay hidden">
    <div class="popup-box">
      <a href="#" class="close-btn" id="closeBtn">X</a>

      <div id="step-1">
        <h2>Log in or create an account</h2>
        <form id="emailForm" class="login-form mt-3" novalidate>
          <div class="input-group">
            <input type="email" id="emailInput" placeholder="University Email (.edu)" class="bubble-input" required>
            <p id="emailError" class="error-msg hidden">Please enter a valid .edu email address.</p>
          </div>
          <button type="submit" class="btn-add">Continue</button>
        </form>
      </div>

      <div id="step-2" class="hidden text-left">
        <h2>Welcome back!</h2>
        <p class="subtitle">Enter your password to log in.</p>

        <form id="passwordForm" class="login-form">
          <div class="input-group">
            <label class="font-bold">Email Address</label>
            <div class="email-edit-group">
              <input type="email" id="disabledEmail" class="bubble-input disabled-input" readonly>
              <button type="button" id="editBtn" class="edit-btn">Edit</button>
            </div>
          </div>

          <div class="input-group mt-3">
            <label class="font-bold">Password</label>
            <div class="password-group">
              <input type="password" id="passwordInput" class="bubble-input" required>
              <button type="button" class="toggle-password" id="togglePasswordBtn">
                <svg viewBox="0 0 24 24" fill="none" class="eye-icon">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </button>
            </div>
          </div>

          <a href="#" class="forgot-pwd">Forgot your password?</a>
          <button type="submit" class="btn-add">Log in</button>
        </form>

        <p class="footer-terms">By continuing, you agree to the updated <a href="#">Terms of Service</a>, and <a
            href="#">Privacy Policy</a>.</p>
      </div>

      <div id="step-3" class="hidden text-left">
        <h2>Create an account</h2>

        <form id="signupForm" class="login-form mt-4">
          <div class="input-group">
            <label class="font-bold">Email</label>
            <div class="email-edit-group">
              <input type="email" id="disabledEmailSignup" class="bubble-input disabled-input" readonly>
              <button type="button" id="editBtnSignup" class="edit-btn">Edit</button>
            </div>
          </div>

          <div class="input-group mt-3">
            <label class="font-bold">Password</label>
            <div class="password-group">
              <input type="password" id="signupPasswordInput" class="bubble-input" required>
              <button type="button" class="toggle-password" id="toggleSignupPasswordBtn">
                <svg viewBox="0 0 24 24" fill="none" class="eye-icon">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </button>
            </div>
          </div>

          <ul class="pwd-requirements">
            <li id="reqLength" class="req-unmet">✓ 8+ characters</li>
            <li id="reqUpper" class="req-unmet">✓ One uppercase letter</li>
            <li id="reqNumber" class="req-unmet">✓ One number</li>
            <li id="reqSpecial" class="req-unmet">✓ One special character</li>
          </ul>

          <button type="submit" id="signupSubmitBtn" class="btn-disabled mt-3" disabled>Create account</button>
        </form>

        <p class="footer-terms">By creating an account, you agree to the <a href="#">Terms of Service</a> and <a
            href="#">Privacy Policy</a>.</p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      var logoEl = document.getElementById('logoText');
      var logoTitle = document.querySelector('.logo');
      var bubbleWrap = document.getElementById('bubbleWrap');
      var floatContainer = document.getElementById('floatBubbles');
      var word = 'Bubble';
      var i = 0;
      function type() {
        if (logoEl && logoTitle && i < word.length) {
          logoEl.textContent += word[i];
          i++;
          setTimeout(type, 320);
        } else if (logoTitle) {
          logoTitle.classList.add('logo-done');
          if (bubbleWrap) bubbleWrap.classList.add('reveal');
          document.body.classList.add('bubble-done');
          if (floatContainer) {
            for (var b = 0; b < 18; b++) {
              var el = document.createElement('div');
              el.className = 'float-bubble';
              el.style.left = Math.random() * 100 + '%';
              el.style.width = el.style.height = (12 + Math.random() * 24) + 'px';
              el.style.animationDelay = (Math.random() * 5) + 's';
              el.style.animationDuration = (6 + Math.random() * 4) + 's';
              floatContainer.appendChild(el);
            }
          }
        }
      }
      setTimeout(type, 800);

      // Handle main bubble click
      bubbleWrap.addEventListener('click', function (e) {
        e.preventDefault();

        // Prevent further clicks
        bubbleWrap.style.pointerEvents = 'none';

        // Add popping animation to main bubble
        bubbleWrap.classList.add('popping-main');

        // Create spray effect
        var hero = document.querySelector('.hero');
        if (hero) {
          for (var s = 0; s < 25; s++) {
            var drop = document.createElement('div');
            drop.className = 'spray-drop';
            var angle = Math.random() * Math.PI * 2;
            var velocity = 150 + Math.random() * 250;
            drop.style.setProperty('--tx', (Math.cos(angle) * velocity) + 'px');
            drop.style.setProperty('--ty', (Math.sin(angle) * velocity) + 'px');
            hero.appendChild(drop);
          }
        }

        // Wait for bubble to completely pop (pop animation is 450ms)
        setTimeout(function () {
          var hero = document.querySelector('.hero');
          if (hero) hero.style.display = 'none'; // Hide the popped bubble completely 

          if (floatContainer) floatContainer.classList.add('fade-out');

          // Only after the bubble is gone and background is fading do we show the popup
          setTimeout(function () {
            if (floatContainer) floatContainer.style.display = 'none';
            var loginPopup = document.getElementById('loginPopup');
            if (loginPopup) loginPopup.classList.remove('hidden');
          }, 400); // Wait for fade out
        }, 650); // Significant delay to clearly show it popped empty space
      });

      // Handle form validation & Step Transition
      var emailForm = document.getElementById('emailForm');
      var emailInput = document.getElementById('emailInput');
      var emailError = document.getElementById('emailError');

      var step1 = document.getElementById('step-1');
      var step2 = document.getElementById('step-2');
      var step3 = document.getElementById('step-3');
      var disabledEmail = document.getElementById('disabledEmail');
      var disabledEmailSignup = document.getElementById('disabledEmailSignup');
      var editBtn = document.getElementById('editBtn');
      var editBtnSignup = document.getElementById('editBtnSignup');
      var closeBtn = document.getElementById('closeBtn');

      if (emailForm) {
        emailForm.addEventListener('submit', function (e) {
          e.preventDefault();
          var email = emailInput.value.trim().toLowerCase();

          if (!email.endsWith('.edu')) {
            emailError.textContent = "Please enter a valid .edu email address.";
            emailError.classList.remove('hidden');
            emailInput.classList.add('input-error');
            return;
          }

          if (email === 'anushkag@unc.edu') {
            emailError.classList.add('hidden');
            emailInput.classList.remove('input-error');
            step1.classList.add('hidden');
            step2.classList.remove('hidden');
            disabledEmail.value = email;
          } else if (email === 'emisang@unc.edu') {
            emailError.classList.add('hidden');
            emailInput.classList.remove('input-error');
            step1.classList.add('hidden');
            step3.classList.remove('hidden');
            disabledEmailSignup.value = email;
          } else {
            emailError.textContent = "Email not recognized. Please use anushkag@unc.edu or emisang@unc.edu for this demo.";
            emailError.classList.remove('hidden');
            emailInput.classList.add('input-error');
          }
        });
      }

      if (editBtn) {
        editBtn.addEventListener('click', function (e) {
          e.preventDefault();
          step2.classList.add('hidden');
          step1.classList.remove('hidden');
        });
      }

      if (editBtnSignup) {
        editBtnSignup.addEventListener('click', function (e) {
          e.preventDefault();
          step3.classList.add('hidden');
          step1.classList.remove('hidden');
        });
      }

      if (closeBtn) {
        closeBtn.addEventListener('click', function (e) {
          e.preventDefault();
          window.location.reload(); // Reset state and go back to hero
        });
      }

      var togglePasswordBtn = document.getElementById('togglePasswordBtn');
      var passwordInput = document.getElementById('passwordInput');
      if (togglePasswordBtn && passwordInput) {
        togglePasswordBtn.addEventListener('click', function (e) {
          e.preventDefault();
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
          } else {
            passwordInput.type = 'password';
          }
        });
      }

      var toggleSignupPasswordBtn = document.getElementById('toggleSignupPasswordBtn');
      var signupPasswordInput = document.getElementById('signupPasswordInput');
      if (toggleSignupPasswordBtn && signupPasswordInput) {
        toggleSignupPasswordBtn.addEventListener('click', function (e) {
          e.preventDefault();
          if (signupPasswordInput.type === 'password') {
            signupPasswordInput.type = 'text';
          } else {
            signupPasswordInput.type = 'password';
          }
        });
      }

      // Password Validation Logic
      var reqLength = document.getElementById('reqLength');
      var reqUpper = document.getElementById('reqUpper');
      var reqNumber = document.getElementById('reqNumber');
      var reqSpecial = document.getElementById('reqSpecial');
      var signupSubmitBtn = document.getElementById('signupSubmitBtn');

      if (signupPasswordInput) {
        signupPasswordInput.addEventListener('input', function () {
          var pwd = signupPasswordInput.value;

          var hasLength = pwd.length >= 8;
          var hasUpper = /[A-Z]/.test(pwd);
          var hasNumber = /[0-9]/.test(pwd);
          var hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(pwd);

          // Update Length
          reqLength.className = hasLength ? 'req-met' : 'req-unmet';

          // Update Upper
          reqUpper.className = hasUpper ? 'req-met' : 'req-unmet';

          // Update Number
          reqNumber.className = hasNumber ? 'req-met' : 'req-unmet';

          // Update Special
          reqSpecial.className = hasSpecial ? 'req-met' : 'req-unmet';

          // Enable/Disable Submit Button
          if (hasLength && hasUpper && hasNumber && hasSpecial) {
            signupSubmitBtn.disabled = false;
            signupSubmitBtn.classList.remove('btn-disabled');
            signupSubmitBtn.classList.add('btn-add');
          } else {
            signupSubmitBtn.disabled = true;
            signupSubmitBtn.classList.add('btn-disabled');
            signupSubmitBtn.classList.remove('btn-add');
          }
        });
      }

    })();
  </script>
  <script src="app.js"></script>
</body>

</html>