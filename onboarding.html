<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble - Welcome</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        /* ---- Bubble Chain Onboarding ---- */
        html,
        body {
            min-height: 100%;
            background: #EEF3F8;
        }

        .ob-page {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            background: #EEF3F8;
        }

        .ob-bubble {
            position: absolute;
            z-index: 1;
            width: min(440px, 92vw);
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: radial-gradient(ellipse 90% 90% at 40% 30%, rgba(255, 255, 255, 0.97), rgba(255, 255, 255, 0.82));
            border-radius: 50%;
            padding: 3rem;
            box-sizing: border-box;
            box-shadow:
                inset 0 0 16px rgba(255, 255, 255, 0.7),
                inset 5px 0 24px rgba(75, 156, 211, 0.2),
                inset -5px 0 24px rgba(123, 175, 212, 0.15),
                0 8px 32px rgba(19, 41, 75, 0.10),
                0 0 0 1.5px rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            transition: all 0.7s cubic-bezier(0.25, 1, 0.5, 1);
            /* Diagonal origin locations */
            left: var(--x);
            top: var(--y);
            transform: translate(-50%, -50%) scale(0.12);
            opacity: 0;
            pointer-events: none;
        }

        /* Hide contents for inactive bubbles to keep them looking like plain bubbles */
        .ob-bubble>* {
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        /* Diagonal coordinates mapping */
        #ob-bubble-1 {
            --x: 15%;
            --y: 15%;
        }

        #ob-bubble-2 {
            --x: 25%;
            --y: 25%;
        }

        #ob-bubble-3 {
            --x: 35%;
            --y: 35%;
        }

        #ob-bubble-4 {
            --x: 45%;
            --y: 45%;
        }

        #ob-bubble-5 {
            --x: 55%;
            --y: 55%;
        }

        #ob-bubble-6 {
            --x: 65%;
            --y: 65%;
        }

        #ob-bubble-7 {
            --x: 75%;
            --y: 75%;
        }

        #ob-bubble-8 {
            --x: 85%;
            --y: 85%;
        }

        /* Upcoming */
        .ob-bubble.upcoming {
            opacity: 0.6;
            filter: blur(2px);
            transform: translate(-50%, -50%) scale(0.12);
        }

        /* Answered (done) */
        .ob-bubble.answered {
            opacity: 0.8;
            filter: blur(1px);
            transform: translate(-50%, -50%) scale(0.15);
        }

        /* Answered (done) */
        .ob-bubble.answered {
            filter: blur(4px);
            opacity: 0.5;
            transform: scale(0.9);
            pointer-events: none;
        }

        /* Active - centered and expanded */
        .ob-bubble.active {
            filter: none;
            opacity: 1;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(1.0);
            z-index: 10;
            pointer-events: auto;
            box-shadow:
                inset 0 0 20px rgba(255, 255, 255, 0.8),
                inset 6px 0 32px rgba(75, 156, 211, 0.3),
                inset -6px 0 32px rgba(123, 175, 212, 0.2),
                0 24px 60px rgba(75, 156, 211, 0.35),
                0 0 0 2px rgba(123, 175, 212, 0.35);
        }

        .ob-bubble.active>* {
            opacity: 1;
            transition-delay: 0.3s;
            /* Fade contents in after expanding */
        }

        /* Bubble step number badge */
        .ob-step-badge {
            font-size: 0.72rem;
            font-weight: 700;
            color: #7BAFD4;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            margin-bottom: 0.6rem;
        }

        .ob-question {
            font-size: 1.45rem;
            font-weight: 800;
            color: #13294B;
            line-height: 1.3;
            margin-bottom: 0.4rem;
        }

        .ob-desc {
            color: #667;
            font-size: 0.9rem;
            margin-bottom: 1.25rem;
        }

        .ob-answer-display {
            font-size: 1rem;
            font-weight: 600;
            color: #4B9CD3;
            margin-top: 0.5rem;
            min-height: 1.4em;
        }

        .ob-input-row {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }

        .ob-input-row .bubble-input {
            flex: 1;
        }

        .ob-next-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.7rem 1.5rem;
            background: linear-gradient(135deg, #7BAFD4, #4B9CD3);
            color: white;
            border: none;
            border-radius: 2rem;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            flex-shrink: 0;
            margin-top: 1.1rem;
        }

        .ob-next-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(75, 156, 211, 0.4);
        }

        .ob-submit-btn {
            width: 100%;
            margin-top: 1rem;
            padding: 0.85rem;
            background: linear-gradient(135deg, #7BAFD4, #4B9CD3);
            color: white;
            border: none;
            border-radius: 2rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .ob-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(75, 156, 211, 0.4);
        }

        .ob-top-logo {
            display: none;
        }

        /* School dropdown overrides for bubble chain */
        .ob-school-wrap {
            position: relative;
            width: 100%;
        }

        textarea.bubble-input {
            resize: none;
            height: 90px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 1rem;
            padding: 0.9rem 1rem;
            font-family: inherit;
        }
    </style>
</head>

<body>
    <a class="ob-top-logo" href="index.html">Bubble</a>
    <!-- Dropdowns rendered on body -->
    <div id="schoolDropdown" class="school-dropdown" style="display:none;"></div>
    <div id="majorDropdown" class="school-dropdown" style="display:none;"></div>

    <form id="onboardingForm" novalidate>
        <div class="ob-page">

            <!-- Bubble 1: Name -->
            <div class="ob-bubble active" id="ob-bubble-1">
                <div class="ob-step-badge">Step 1 of 8</div>
                <div class="ob-question">What's your full name?</div>
                <div class="ob-desc">So your matches know who you are.</div>
                <div class="ob-input-row">
                    <input type="text" id="nameInput" class="bubble-input" placeholder="e.g. Jane Doe"
                        autocomplete="name">
                    <button type="button" class="ob-next-btn" data-step="1">Next →</button>
                </div>
                <div class="ob-answer-display" id="ans-1"></div>
            </div>

            <!-- Bubble 2: Age -->
            <div class="ob-bubble upcoming" id="ob-bubble-2">
                <div class="ob-step-badge">Step 2 of 8</div>
                <div class="ob-question">How old are you?</div>
                <div class="ob-desc">You must be at least 18 to use Bubble.</div>
                <div class="ob-input-row">
                    <input type="number" id="ageInput" class="bubble-input" min="18" max="99" placeholder="e.g. 21">
                    <button type="button" class="ob-next-btn" data-step="2">Next →</button>
                </div>
                <div class="ob-answer-display" id="ans-2"></div>
            </div>

            <!-- Bubble 3: Gender -->
            <div class="ob-bubble upcoming" id="ob-bubble-3">
                <div class="ob-step-badge">Step 3 of 8</div>
                <div class="ob-question">How do you identify?</div>
                <div class="ob-desc">This helps us organize your discover feed.</div>
                <div class="ob-input-row">
                    <select id="genderInput" class="bubble-input" style="appearance:none;">
                        <option value="" disabled selected>Select gender</option>
                        <option value="Woman">Woman</option>
                        <option value="Man">Man</option>
                        <option value="Non-binary">Non-binary</option>
                        <option value="Prefer not to say">Prefer not to say</option>
                    </select>
                    <button type="button" class="ob-next-btn" data-step="3">Next →</button>
                </div>
                <div class="ob-answer-display" id="ans-3"></div>
            </div>

            <!-- Bubble 4: Secondary Email -->
            <div class="ob-bubble upcoming" id="ob-bubble-4">
                <div class="ob-step-badge">Step 4 of 8</div>
                <div class="ob-question">Any secondary email?</div>
                <div class="ob-desc">For when your .edu email expires.</div>
                <div class="ob-input-row">
                    <input type="email" id="secondaryEmailInput" class="bubble-input"
                        placeholder="e.g. personal@gmail.com">
                    <button type="button" class="ob-next-btn" data-step="4">Next →</button>
                </div>
                <div class="ob-answer-display" id="ans-4"></div>
            </div>

            <!-- Bubble 5: Phone -->
            <div class="ob-bubble upcoming" id="ob-bubble-5">
                <div class="ob-step-badge">Step 5 of 8</div>
                <div class="ob-question">What's your phone number?</div>
                <div class="ob-desc">We use SMS to verify real students.</div>
                <div class="ob-input-row">
                    <input type="tel" id="phoneInput" class="bubble-input" placeholder="(555) 555-5555">
                    <button type="button" class="ob-next-btn" data-step="5">Next →</button>
                </div>
                <div class="ob-answer-display" id="ans-5"></div>
            </div>

            <!-- Bubble 6: School -->
            <div class="ob-bubble upcoming" id="ob-bubble-6">
                <div class="ob-step-badge">Step 6 of 8</div>
                <div class="ob-question">What school do you attend?</div>
                <div class="ob-desc">Help us find students on your campus.</div>
                <div class="ob-school-wrap">
                    <input type="text" id="schoolSearchInput" class="bubble-input" autocomplete="off"
                        placeholder="Search for your college..." style="width:100%; box-sizing:border-box;">
                    <input type="text" id="schoolInput" style="display:none;">
                </div>
                <p id="schoolError" class="error-msg hidden" style="margin-top:0.4rem; font-size:0.82rem;">Please select
                    a school from the list.</p>
                <button type="button" class="ob-next-btn" id="schoolNextBtn" style="margin-top:1.1rem; width:100%;">Next
                    →</button>
                <div class="ob-answer-display" id="ans-6"></div>
            </div>

            <!-- Bubble 7: Major -->
            <div class="ob-bubble upcoming" id="ob-bubble-7">
                <div class="ob-step-badge">Step 7 of 8</div>
                <div class="ob-question">What's your major?</div>
                <div class="ob-desc">Search to find peers with similar academic interests.</div>

                <input type="text" id="majorSearchInput" class="bubble-input" placeholder="Search major..."
                    autocomplete="off">
                <input type="hidden" id="majorInput" name="major">

                <p id="majorError" class="error-msg hidden" style="margin-top:0.4rem; font-size:0.82rem;">Please select
                    a major from the list.</p>
                <button type="button" class="ob-next-btn" id="majorNextBtn" style="margin-top:1.1rem; width:100%;">Next
                    →</button>
                <div class="ob-answer-display" id="ans-7"></div>
            </div>

            <!-- Bubble 8: Bio -->
            <div class="ob-bubble upcoming" id="ob-bubble-8">
                <div class="ob-step-badge">Step 8 of 8</div>
                <div class="ob-question">Tell us about yourself</div>
                <div class="ob-desc">Write a short bio for your profile card.</div>
                <textarea id="bioInput" class="bubble-input" placeholder="Coffee addict, hackathon lover..."></textarea>
                <button type="submit" class="ob-submit-btn">Complete Profile ✓</button>
            </div>

        </div>
    </form>

    <script src="app.js"></script>
    <script>
        document.body.classList.add('bubble-done');

        var currentStep = 1;
        var totalSteps = 8;

        function getBubble(n) { return document.getElementById('ob-bubble-' + n); }
        function getAns(n) { return document.getElementById('ans-' + n); }

        function advanceTo(n) {
            // Mark all previous as answered
            for (var i = 1; i < n; i++) {
                getBubble(i).classList.remove('active', 'upcoming');
                getBubble(i).classList.add('answered');
            }
            // Mark current as active
            var cur = getBubble(n);
            cur.classList.remove('upcoming', 'answered');
            cur.classList.add('active');
            // Mark upcoming
            for (var j = n + 1; j <= totalSteps; j++) {
                getBubble(j).classList.remove('active', 'answered');
                getBubble(j).classList.add('upcoming');
            }
            currentStep = n;
            // Delay input focus slightly for animation to complete
            setTimeout(function () {
                var inp = cur.querySelector('input:not([style*="display:none"]), select, textarea');
                if (inp) inp.focus();
            }, 600);
        }

        // Generic next-btn handler
        document.querySelectorAll('.ob-next-btn[data-step]').forEach(function (btn) {
            btn.addEventListener('click', function () {
                var step = parseInt(this.dataset.step);
                var bubble = getBubble(step);
                var input = bubble.querySelector('input:not([style*="display:none"]), select');
                if (!input || !input.value.trim()) {
                    input && input.focus();
                    input && (input.style.outline = '2px solid #e86');
                    setTimeout(function () { if (input) input.style.outline = ''; }, 1000);
                    return;
                }
                // Show answer summary in bubble
                getAns(step).textContent = '✓ ' + input.value;
                if (step < totalSteps) advanceTo(step + 1);
            });
        });

        // --- School dropdown ---
        var FALLBACK_SCHOOLS = [
            "Auburn University", "Arizona State University", "Boston College", "Boston University",
            "Brigham Young University", "Brown University", "California Institute of Technology",
            "Carnegie Mellon University", "Case Western Reserve University", "Clemson University",
            "Columbia University", "Cornell University", "Dartmouth College", "Duke University",
            "Emory University", "Florida State University", "Fordham University", "Georgetown University",
            "Georgia Institute of Technology", "Harvard University", "Indiana University",
            "Johns Hopkins University", "Lehigh University", "Louisiana State University",
            "Michigan State University", "MIT", "New York University", "Northeastern University",
            "Northwestern University", "Notre Dame", "Ohio State University", "Penn State",
            "Princeton University", "Purdue University", "Rice University", "Rutgers University",
            "Stanford University", "Syracuse University", "Temple University", "Texas A&M University",
            "Tulane University", "UC Berkeley", "UC Davis", "UC Irvine", "UC Los Angeles",
            "UC San Diego", "UC Santa Barbara", "University of Alabama", "University of Arizona",
            "University of Chicago", "University of Colorado Boulder", "University of Connecticut",
            "University of Florida", "University of Georgia", "University of Houston",
            "University of Illinois Urbana-Champaign", "University of Iowa",
            "University of Kansas", "University of Kentucky", "University of Maryland",
            "University of Massachusetts Amherst", "University of Miami",
            "University of Michigan", "University of Minnesota", "University of Missouri",
            "University of Nebraska", "University of North Carolina at Chapel Hill",
            "University of Oregon", "University of Pennsylvania", "University of Pittsburgh",
            "University of Rochester", "University of South Carolina", "University of Southern California",
            "University of Tennessee", "University of Texas at Austin", "University of Utah",
            "University of Virginia", "University of Washington", "University of Wisconsin-Madison",
            "Vanderbilt University", "Villanova University", "Virginia Tech", "Wake Forest University",
            "Washington University in St. Louis", "William & Mary", "Yale University"
        ];
        var allSchools = FALLBACK_SCHOOLS.slice().sort();

        var schoolSearchInput = document.getElementById('schoolSearchInput');
        var schoolInput = document.getElementById('schoolInput');
        var schoolDropdown = document.getElementById('schoolDropdown');
        var schoolError = document.getElementById('schoolError');
        var schoolNextBtn = document.getElementById('schoolNextBtn');

        fetch('http://universities.hipolabs.com/search?country=United+States')
            .then(r => r.json())
            .then(data => {
                var api = [...new Set(data.map(i => i.name))];
                allSchools = [...new Set([...FALLBACK_SCHOOLS, ...api])].sort();
            }).catch(() => { });

        function positionDropdown() {
            var rect = schoolSearchInput.getBoundingClientRect();
            schoolDropdown.style.top = (rect.bottom + 6) + 'px';
            schoolDropdown.style.left = rect.left + 'px';
            schoolDropdown.style.width = rect.width + 'px';
        }

        function renderDropdown(query) {
            schoolDropdown.innerHTML = '';
            if (!query) { schoolDropdown.style.display = 'none'; return; }
            var filtered = allSchools.filter(s => s.toLowerCase().includes(query.toLowerCase())).slice(0, 8);
            if (!filtered.length) { schoolDropdown.style.display = 'none'; return; }
            filtered.forEach(function (school) {
                var item = document.createElement('div');
                item.className = 'school-dropdown-item';
                var idx = school.toLowerCase().indexOf(query.toLowerCase());
                item.innerHTML = school.slice(0, idx) + '<strong>' + school.slice(idx, idx + query.length) + '</strong>' + school.slice(idx + query.length);
                item.addEventListener('mousedown', function (e) {
                    e.preventDefault();
                    schoolSearchInput.value = school;
                    schoolInput.value = school;
                    schoolDropdown.style.display = 'none';
                    schoolError.classList.add('hidden');
                });
                schoolDropdown.appendChild(item);
            });
            positionDropdown();
            schoolDropdown.style.display = 'block';
        }

        schoolSearchInput.addEventListener('input', function () { schoolInput.value = ''; renderDropdown(this.value.trim()); });
        schoolSearchInput.addEventListener('blur', function () { setTimeout(() => { schoolDropdown.style.display = 'none'; }, 150); });
        schoolSearchInput.addEventListener('focus', function () { if (this.value.trim()) renderDropdown(this.value.trim()); });

        schoolNextBtn.addEventListener('click', function () {
            if (!schoolInput.value.trim()) {
                schoolError.classList.remove('hidden');
                schoolSearchInput.focus();
                return;
            }
            schoolError.classList.add('hidden');
            getAns(6).textContent = '✓ ' + schoolInput.value;
            advanceTo(7);
        });

        // --- Major dropdown ---
        var ALL_MAJORS = [
            "Accounting", "Architecture", "Art History", "Biology", "Business Administration",
            "Chemical Engineering", "Chemistry", "Civil Engineering", "Communications", "Computer Science",
            "Criminal Justice", "Data Science", "Economics", "Education", "Electrical Engineering",
            "English", "Environmental Science", "Finance", "Graphic Design", "History",
            "Information Technology", "International Relations", "Journalism", "Kinesiology", "Linguistics",
            "Marketing", "Mathematics", "Mechanical Engineering", "Music", "Nursing", "Philosophy",
            "Physics", "Political Science", "Pre-Med", "Pre-Law", "Psychology", "Public Health",
            "Sociology", "Software Engineering", "Statistics", "Theater Arts"
        ];

        var majorSearchInput = document.getElementById('majorSearchInput');
        var majorInput = document.getElementById('majorInput');
        var majorDropdown = document.getElementById('majorDropdown');
        var majorError = document.getElementById('majorError');
        var majorNextBtn = document.getElementById('majorNextBtn');

        function positionMajorDropdown() {
            var rect = majorSearchInput.getBoundingClientRect();
            majorDropdown.style.top = (rect.bottom + 6) + 'px';
            majorDropdown.style.left = rect.left + 'px';
            majorDropdown.style.width = rect.width + 'px';
        }

        function renderMajorDropdown(query) {
            majorDropdown.innerHTML = '';
            if (!query) { majorDropdown.style.display = 'none'; return; }
            var filtered = ALL_MAJORS.filter(m => m.toLowerCase().includes(query.toLowerCase())).slice(0, 8);
            if (!filtered.length) { majorDropdown.style.display = 'none'; return; }
            filtered.forEach(function (major) {
                var item = document.createElement('div');
                item.className = 'school-dropdown-item'; // Reuse same CSS class
                var idx = major.toLowerCase().indexOf(query.toLowerCase());
                item.innerHTML = major.slice(0, idx) + '<strong>' + major.slice(idx, idx + query.length) + '</strong>' + major.slice(idx + query.length);
                item.addEventListener('mousedown', function (e) {
                    e.preventDefault();
                    majorSearchInput.value = major;
                    majorInput.value = major;
                    majorDropdown.style.display = 'none';
                    majorError.classList.add('hidden');
                });
                majorDropdown.appendChild(item);
            });
            positionMajorDropdown();
            majorDropdown.style.display = 'block';
        }

        majorSearchInput.addEventListener('input', function () { majorInput.value = ''; renderMajorDropdown(this.value.trim()); });
        majorSearchInput.addEventListener('blur', function () { setTimeout(() => { majorDropdown.style.display = 'none'; }, 150); });
        majorSearchInput.addEventListener('focus', function () { if (this.value.trim()) renderMajorDropdown(this.value.trim()); });

        majorNextBtn.addEventListener('click', function () {
            if (!majorInput.value.trim()) {
                majorError.classList.remove('hidden');
                majorSearchInput.focus();
                return;
            }
            majorError.classList.add('hidden');
            getAns(7).textContent = '✓ ' + majorInput.value;
            advanceTo(8);
        });

        // Reposition dropdowns on resize/scroll
        window.addEventListener('resize', function () {
            if (schoolDropdown.style.display !== 'none') positionDropdown();
            if (majorDropdown.style.display !== 'none') positionMajorDropdown();
        });
        window.addEventListener('scroll', function () {
            if (schoolDropdown.style.display !== 'none') positionDropdown();
            if (majorDropdown.style.display !== 'none') positionMajorDropdown();
        });

        // Submit
        document.getElementById('onboardingForm').addEventListener('submit', function (e) {
            e.preventDefault();
            var bio = document.getElementById('bioInput').value.trim();
            if (!bio) { document.getElementById('bioInput').focus(); return; }
            var profileData = {
                name: document.getElementById('nameInput').value,
                age: document.getElementById('ageInput').value,
                gender: document.getElementById('genderInput').value,
                secondaryEmail: document.getElementById('secondaryEmailInput').value,
                phone: document.getElementById('phoneInput').value,
                school: schoolInput.value,
                major: document.getElementById('majorInput').value,
                bio: bio
            };
            localStorage.setItem('bubble_user_profile', JSON.stringify(profileData));
            window.location.href = 'profiles.html';
        });
    </script>
</body>

</html>